// -----------------------------------------------------------------------------
// This file was autogenerated by symforce from template:
//     function/FUNCTION.h.jinja
// Do NOT modify by hand.
// -----------------------------------------------------------------------------

#pragma once

#include <matrix/math.hpp>

namespace sym
{

/**
 * This function was autogenerated from a symbolic function. Do not modify by hand.
 *
 * Symbolic function: applyCorrection
 *
 * Args:
 *     state: Matrix31
 *     cov: Matrix33
 *     K: Matrix31
 *     innov: Scalar
 *     S: Scalar
 *
 * Outputs:
 *     state_new: Matrix31
 *     cov_new: Matrix33
 */
template <typename Scalar>
void Applycorrection(const matrix::Matrix<Scalar, 3, 1> &state,
		     const matrix::Matrix<Scalar, 3, 3> &cov, const matrix::Matrix<Scalar, 3, 1> &K,
		     const Scalar innov, const Scalar S,
		     matrix::Matrix<Scalar, 3, 1> *const state_new = nullptr,
		     matrix::Matrix<Scalar, 3, 3> *const cov_new = nullptr)
{
	// Total ops: 42

	// Input arrays

	// Intermediate terms (5)
	const Scalar _tmp0 = 2 * S;
	const Scalar _tmp1 =
		-Scalar(0.5) * K(0, 0) * K(1, 0) * _tmp0 + Scalar(0.5) * cov(0, 1) + Scalar(0.5) * cov(1, 0);
	const Scalar _tmp2 = K(2, 0) * _tmp0;
	const Scalar _tmp3 =
		-Scalar(0.5) * K(0, 0) * _tmp2 + Scalar(0.5) * cov(0, 2) + Scalar(0.5) * cov(2, 0);
	const Scalar _tmp4 =
		-Scalar(0.5) * K(1, 0) * _tmp2 + Scalar(0.5) * cov(1, 2) + Scalar(0.5) * cov(2, 1);

	// Output terms (2)
	if (state_new != nullptr) {
		matrix::Matrix<Scalar, 3, 1> &_state_new = (*state_new);

		_state_new(0, 0) = K(0, 0) * innov + state(0, 0);
		_state_new(1, 0) = K(1, 0) * innov + state(1, 0);
		_state_new(2, 0) = K(2, 0) * innov + state(2, 0);
	}

	if (cov_new != nullptr) {
		matrix::Matrix<Scalar, 3, 3> &_cov_new = (*cov_new);

		_cov_new(0, 0) = -Scalar(0.5) * std::pow(K(0, 0), Scalar(2)) * _tmp0 + Scalar(1.0) * cov(0, 0);
		_cov_new(1, 0) = _tmp1;
		_cov_new(2, 0) = _tmp3;
		_cov_new(0, 1) = _tmp1;
		_cov_new(1, 1) = -Scalar(0.5) * std::pow(K(1, 0), Scalar(2)) * _tmp0 + Scalar(1.0) * cov(1, 1);
		_cov_new(2, 1) = _tmp4;
		_cov_new(0, 2) = _tmp3;
		_cov_new(1, 2) = _tmp4;
		_cov_new(2, 2) = -Scalar(0.5) * std::pow(K(2, 0), Scalar(2)) * _tmp0 + Scalar(1.0) * cov(2, 2);
	}
}  // NOLINT(readability/fn_size)

// NOLINTNEXTLINE(readability/fn_size)
}  // namespace sym
